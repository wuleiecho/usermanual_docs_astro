---
title: 语义分割使用说明
description: Docs intro
layout: ../../layouts/MainLayout.astro
---


## 功能介绍

---

### **简介**

ImageX训练平台支持支持图像分类、目标检测、语义分割三类模型的训练及效果评估，三类模型的功能区别如下：

- 图像分类：按照代表图像整体内容的标签对图像进行分类。适用于图片内容单一、需要给整张图片进行分类的场景
- 目标检测：通常使用矩形框来描述目标位置，任务是找出图像中所有需要检测的目标，确定它们的位置、类别。适合图中有多个主体需要识别、或要识别主体位置及数量的场景
- 语义分割：是指将图像中的每个像素链接到类标签的过程。适合图中有多个主体、需识别其位置或轮廓的场景

以下是关于语义分割模型的技术文档。

### **应用场景**

- 缺陷检测：将缺陷部分从产品图像中分离出来，进一步分析缺陷的特征
- 图像修复：将图像中的缺陷部分分离出来，用于图像修复
- 材料分离：将不同材料从图像中分离出来，用于材料分类和分析
- 工件追踪：将工件从图像中分离出来，用于工件追踪和自动操作

### **使用流程**

训练模型的基本流程如下图所示，下面将详细介绍每一步的操作方式和注意事项

![img](/images/语义分割使用说明/1.jpeg)





## 数据准备

### 分割数据标注

---

**标注工具安装**

**安装准备工作**

- 安装python

[Python下载地址](https://www.python.org/downloads/)，一路下一步，默认安装即可。

- 安装PaddlePaddle 2.2.0
- 在命令行中输入：如下图

（打开命令行方法：快捷键，Windows+R，在“运行”窗口中输入 cmd）

  ![img](/images/语义分割使用说明/79.png)

- 在命令行中输入 ：python -m pip install paddlepaddle==2.2.0 -i [https://mirror.baidu.com/pypi/simple](https://mirror.baidu.com/pypi/simple)

  ![img](/images/语义分割使用说明/2.png)

**安装eiseg 0.4.0**

- 在命令行中输入：pip install eiseg==0.4.0

（打开命令行方法：快捷键，Windows+R，在“运行”窗口中输入 cmd）

![img](/images/语义分割使用说明/3.png)

（速度慢，耐心等待）

- 安装出错：报以下错误，ERROR: Could not install packages due to an OSError

[解决链接](https://blog.csdn.net/file_data/article/details/121330581) ，修改完注册表后，再次运行 pip install eiseg==0.4.0

![img](/images/语义分割使用说明/4.png)

![img](/images/语义分割使用说明/5.png)

**eiseg0.4.0 软件使用说明**

[使用参考链接](https://github.com/PaddlePaddle/PaddleSeg/tree/develop/EISeg)（可选择简体中文，使用说明在页面靠下）

- 打开软件界面：
- 在命令行中输入： eiseg

（打开命令行方法：快捷键，Windows+R，在“运行”窗口中输入 cmd）

![img](/images/语义分割使用说明/6.png)

- 打开标注软件界面：

  ![img](/images/语义分割使用说明/7.png)

模型参数加载

- 打开界面后，根据标注场景，选择合适的网络模型及参数下载解压后，模型结构*.pdmodel 及相应的模型参数*.pdiparams需要放到同一个目录下，加载模型时只需选择*.pdiparams结尾的模型参数位置即可。

- 下载模型参数：[下载地址](https://github.com/PaddlePaddle/PaddleSeg/tree/develop/EISeg)，这里推荐使用高精度模型，下载后解压备用。

  ![img](/images/语义分割使用说明/8.png)

- 点击页面 加载模型参数（如下图），选择已解压的模型文件，静态图模型初始化时间稍长，请耐心等待模型加载完成后进行下一步操作。

正确加载的模型参数会记录在近期模型参数中，可以方便切换，并且下次打开软件时自动 加载退出时的模型参数。

![img](/images/语义分割使用说明/9.png)

**图像加载**

点击上方菜单栏 文件-->打开文件夹，打开待标注图像/图像文件夹。当看到主界面图像正确加载，数据列表正确出现图像路径即可。批量标注时建议使用打开图像文件夹，如下图所示。

![img](/images/语义分割使用说明/10.png)

**标签添加/加载**

- 通过添加标签新建标签，标签分为4列，分别对应像素值、说明、颜色和删除。
- 新建好的标签，建议通过上方菜单栏 导出标签列表 保存为txt文件。其他合作者可以通过加载标签列表将标签导入。通过加载方式导入的标签，重启软件后会自动加载。

注：标签说明，建议为标注缺陷的名称

![img](/images/语义分割使用说明/11.png)

**标注快捷键**

设置完成后即可开始进行标注，默认情况下常用的按键/快捷键如下，如需修改可按E弹出快捷键修改。

|                       |                   |
| --------------------- | ----------------- |
| 部分按键/快捷键       | 功能              |
| 鼠标左键              | 增加正样本点      |
| 鼠标右键              | 增加负样本点      |
| 鼠标中键              | 平移图像          |
| Ctrl+鼠标中键（滚轮） | 缩放图像          |
| S                     | 切换上一张图      |
| F                     | 切换下一张图      |
| Space（空格）         | 完成标注/切换状态 |
| Ctrl+Z                | 撤销              |
| Ctrl+Shift+Z          | 清除              |
| Ctrl+Y                | 重做              |
| Ctrl+A                | 打开图像          |
| Shift+A               | 打开文件夹        |
| E                     | 打开快捷键表      |
| Backspace（退格）     | 删除多边形        |
| 鼠标双击（点）        | 删除点            |
| 鼠标双击（边）        | 添加点            |

**多边形标注**

- 通过快捷键选中需要标注的多边形区域，交互完成后使用Space（空格）完成标注，此时出现多边形边界；

示例：如下图一绿色为正样本点，红色为负样本点，通过正负样本点选中需要标注的玻 璃亮线区域，使用Space（空格）完成标注，此时出现多边形边界，如图二；

![img](/images/语义分割使用说明/12.png)

![img](/images/语义分割使用说明/13.png)

- 多边形可以删除，鼠标左键选中多边形区域后，使用backspace（删除键），删除选中的多边形区域。
- 当需要在多边形内部继续进行标注，则使用空格切换为交互模式，此时多边形无法选中和更改。
- 使用鼠标左边可以对锚点进行 拖动；鼠标左键双击锚点可以 删除锚点；双击两点之间的边则可在此边 添加一个锚点。
- 打开功能-->保留最大连通块 后，所有的点击只会在图像中保留面积最大的区域，其余小区域将不会显示和保存。
- 完成一张图片标注并保存后，按F键切换下一张图片，继续标注所有图片。

**标注保存格式**

- 若不设置保存路径，默认保存至当前图像文件夹下的label文件夹中。如下图

  ![img](/images/语义分割使用说明/14.png)

- 也可以在标注前将菜单栏自动保存设置上，设定好文件夹即可，这样在使用时切换图像会自动将完成标注的图像进行保存。

- 也可打开保存 JSON保存 或 COCO保存 后，多边形会被记录，加载时会自动加载。

- 如果有图像之间名称相同但后缀名不同，可以打开 功能-->标签和图像使用相同扩展名。



### 数据格式转换

---

标注完成后需将数据格式转换方可上传训练平台开始训练。

**Step 1** 安装anaconda，链接：[https://www.anaconda.com/](https://www.anaconda.com/)

**Step 2** 安装拆分数据集脚本：[https://share.weiyun.com/dvCJKFve](https://share.weiyun.com/dvCJKFve) 下载解压后保存

**Step 3** 打开该文件夹：

![img](/images/语义分割使用说明/15.png)

**Step 4** 在文件夹顶部地址栏输入cmd回车：

![img](/images/语义分割使用说明/16.png)

**Step 5** 输入命令 conda activate base：

![img](/images/语义分割使用说明/17.png)

安装出错，可以网络搜索 windows配置anaconda环境变量

**Step 6** 安装依赖包 pip install pycocotools -i [https://pypi.tuna](https://pypi.tuna/) .tsinghua.edu.cn/simple（已安装可跳过此步骤）：

![img](/images/语义分割使用说明/18.png)

**Step 7** 根据数据集类型使用命令进行切分：

分割：python dataset_split_code.py --dataset_dir D:/OneDrive/work/Dataset/det_test --task seg --val_value 0.2 --test_value 0.0

说明：

（1）标注信息文件的存放目录应命名为Annotations，原图像的存放目录应命名为JPEGImages：

![img](/images/语义分割使用说明/19.png)

（2）切分数据前，检查图像名称务必不要出现空格、中文名、括号、点号等（如下图）：

![img](/images/语义分割使用说明/20.png)

（3）命令中D:/OneDrive/work/Dataset/det_test是存放标注和原图像的目录，需替换成实际标注和图像的目录，如示例，我的目录为：F:/furu/shifanfenge）：

![img](/images/语义分割使用说明/21.png)

![img](/images/语义分割使用说明/22.png)

**Step 8** 数据集划分完成后，也可在目录中查看数据格式转换结果，将数据文件打包上传训练平台就可以训练了！

![img](/images/语义分割使用说明/23.png)



### 创建数据集

---

**Step 1** 登录训练平台后，点击侧边栏的【训练任务管理】

![img](/images/语义分割使用说明/24.png)

**Step 2** 点击训练节点下拉框选择相应的训练节点

![img](/images/语义分割使用说明/25.png)

**Step 3** 点击【获取训练节点数据】按钮，获取对应训练节点的数据集列表信息

![img](/images/语义分割使用说明/26.png)

**Step 4** 点击导航栏的【数据集】

![img](/images/语义分割使用说明/27.png)

**Step 5** 点击【新建数据集】按钮

![img](/images/语义分割使用说明/28.png)

**Step 6** 填写相应的数据集信息，并选择数据集类型为【语义分割】（*号为必填项）

![img](/images/语义分割使用说明/29.png)

**Step 7** 确认无误后点击【OK】，这时页面会显示新创建的数据集，且【数据集状态】是【空数据集】

![img](/images/语义分割使用说明/30.png)



### 导入数据集

---

**数据集要求：**

1、导入的训练图片格式仅支持bmp/jpg/png/jpeg，

2、导入的数据压缩包size的最大值为900M；

3、导入的数据压缩包命名仅支持英文、数字、下划线

4、导入的训练数据集内一定要包含labels.txt，train_list.txt和val_list.txt文件，且文件内容不能为空，test_list.txt文件不作要求；

5、导入的训练数据集内单标签分类的⽂件最大数量为5000，图像集合的最⼤数量为20000，分类/检测/分割标签的最大数分别为：1000，80，255；

6、导入数据的时间最多不能超过18分钟，否则数据会上传失败；

**导入数据集步骤：**

**Step 1** 点击【操作】栏下新建数据集一行的【导入】按钮

![img](/images/语义分割使用说明/31.png)

**Step 2** 点击【数据集上传】上传数据集划分后的数据压缩包

![img](/images/语义分割使用说明/32.png)

**Step 3** 等待数据上传结束（具体时间视网速、数据大小而定）

![img](/images/语义分割使用说明/33.png)
**Step 4** 点击【OK】按钮

![img](/images/语义分割使用说明/34.png)

**Step 5** 点击【刷新】按钮，【数据集状态】会由【空数据集】变为【数据集已经切分】

![img](/images/语义分割使用说明/35.png)

![img](/images/语义分割使用说明/36.png)



### 预览数据集

------

**Step 1** 点击【预览】按钮，可查看数据集相关信息（注：只有当【数据集状态】是【数据集已经切分】，才可以点击【预览】按钮，其他状态下【预览】按钮会呈现灰色，无法点击）

![img](/images/语义分割使用说明/37.png)

**Step 2**【预览】页面默认显示的是【全量数据集】和未标注的图片，可通过下拉框选择相应的图片以及勾选【显示标注】来查看标注情况

![img](/images/语义分割使用说明/38.png)

![img](/images/语义分割使用说明/39.png)

**Step 3** 点击【数据集预览】内的图片，每张图片可以放大，缩小，切换上（下）一张

![img](/images/语义分割使用说明/40.png)

**Step 4** 点击【OK】关闭【预览】页面（注：点击【Cancel】、右上角的【X】或页面任一位置都可以关闭【预览】页面）

![img](/images/语义分割使用说明/41.png)









## 模型训练

### 创建训练项目

------

**Step 1** 点击切换到【项目】页面

![img](/images/语义分割使用说明/42.png)

**Step 2** 点击【新建项目】按钮

![img](/images/语义分割使用说明/43.png)

**Step 3** 填写项目信息，项目类型选择【语义分割】，数据集选择已创建的分割数据集（*号为必填项）

![img](/images/语义分割使用说明/44.png)

**Step 4** 确认无误后点击【OK】

![img](/images/语义分割使用说明/45.png)



### 创建训练任务

------

**Step 1** 点击【操作】栏下新增项目一行的【新建任务】按钮

![img](/images/语义分割使用说明/46.png)

**Step 2** 在新建任务弹窗中，设置训练参数（可选择默认参数）

![img](/images/语义分割使用说明/47.png)

**Step 3** 设置完训练参数后，点击右下角【创建并启动训练】按钮

![img](/images/语义分割使用说明/48.png)



### 查看训练状态

------

**Step 1** 点击新建项目左侧的【+】按钮，可以看到任务的训练进度（注：若训练过程中需要暂停，可点击【中止训练】按钮，随后点击【继续训练】按钮可恢复训练）

![img](/images/语义分割使用说明/49.png)

**Step 2** 等待任务训练完成

![img](/images/语义分割使用说明/50.png)





## 模型导出

### 生成推理模型

------

- 任务训练完成后，点击新建任务右侧对应的【导出推理模型】按钮

![img](/images/语义分割使用说明/51.png)

![img](/images/语义分割使用说明/52.png)



### 下载推理模型

------

**Step 1** 点击切换到【模型】页面

![img](/images/语义分割使用说明/53.png)

**Step 2** 点击刚刚导出的模型右侧对应的【下载】按钮

![img](/images/语义分割使用说明/54.png)

![img](/images/语义分割使用说明/55.png)





## 模型测试

### 生成模型评估报告

------

- 任务训练完成后，点击新建任务右侧对应的【评估】按钮

![img](/images/语义分割使用说明/56.png)

![img](/images/语义分割使用说明/57.png)



### 下载模型评估报告

------

- 点击新建任务右侧的【下载评估报告】按钮

![img](/images/语义分割使用说明/58.png)

![img](/images/语义分割使用说明/59.png)





### 模型单图测试

------

**图片要求：**

导入的测试图片格式仅支持bmp/jpg/png/jpeg/tif，其他图片格式不支持。

**单图测试步骤：**

**Step 1** 点击刚刚导出的模型右侧对应的【单图测试】按钮

![img](/images/语义分割使用说明/60.png)

![img](/images/语义分割使用说明/61.png)

**Step 2** 点击【upload】按钮，上传所需预测的图片（注：图片格式为bmp/jpg/png/jpeg/tif，若多次上传，则仅保留最后一次上传的图片）

![img](/images/语义分割使用说明/62.png)

**Step 3**点击上传后的图片，可放大显示

![img](/images/语义分割使用说明/63.png)

**Step 4**点击【预测】按钮，显示正在预测中

![img](/images/语义分割使用说明/64.png)

**Step 5**等待预测完成

![img](/images/语义分割使用说明/65.png)

**Step 6**点击图片，可放大查看预测结果图片

![img](/images/语义分割使用说明/66.png)

**Step 7**点击【下载】按钮，下载预测结果图片

![img](/images/语义分割使用说明/67.png)

![img](/images/语义分割使用说明/68.png)

**Step 8**点击【取消】按钮，关闭【单图测试】页面，返回到【模型】页面

![img](/images/语义分割使用说明/69.png)



### 模型批量测试

------

**数据要求：**

1、导入的测试图片格式仅支持bmp/jpg/png/jpeg/tif，其他图片格式不支持

2、导入的数据压缩包size的最大值为900M

3、导入的数据压缩包命名仅支持英文、数字、下划线

4、导入数据的时间最多不能超过18分钟，否则数据会上传失败

1、导入的测试图片格式仅支持bmp/jpg/png/jpeg/tif，其他图片格式不支持

2、导入的数据压缩包size的最大值为900M

3、导入的数据压缩包命名仅支持英文、数字、下划线

4、导入数据的时间最多不能超过18分钟，否则数据会上传失败

**批量测试步骤：**

**Step 1** 点击刚刚导出的模型右侧对应的【批量测试】按钮

![img](/images/语义分割使用说明/70.png)

![img](/images/语义分割使用说明/71.png)

**Step 2** 点击【upload】按钮上传需要测试的zip文件（注：若多次上传，则仅保留最后一次上传的文件）

![img](/images/语义分割使用说明/72.png)

**Step 3** 等待上传结束

![img](/images/语义分割使用说明/73.png)

**Step 4** 点击【批量图预测】按钮

![img](/images/语义分割使用说明/74.png)

![img](/images/语义分割使用说明/75.png)

**Step 5** 点击【下载】按钮，等待一会

![img](/images/语义分割使用说明/76.png)

![img](/images/语义分割使用说明/77.png)

**Step 6** 点击【取消】按钮，关闭【批量测试】页面，返回到【模型】页面

![img](/images/语义分割使用说明/78.png)